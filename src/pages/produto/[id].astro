---
import Layout from "../../layouts/Layout.astro"
import ProductDetail from "../../components/products/ProductDetail.astro"
import { doc, getDoc } from 'firebase/firestore'
import { db } from '../../core/lib/firebase'

// Buscar produto dinamicamente
const id = Astro.params.id!
const docRef = doc(db, 'produtos', id)
const docSnap = await getDoc(docRef)

if (!docSnap.exists()) {
  return Astro.redirect("/produtos?erro=produto-nao-encontrado")
}

const product = { id: docSnap.id, ...docSnap.data() }
---

<Layout title={product.nome ?? "Produto"}>
  <ProductDetail product={product} />
</Layout>
